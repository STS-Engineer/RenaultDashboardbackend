name: Deploy Backend (FastAPI)

on:
  push:
    branches: [main]
    paths:
      - backend/**

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Deploy to Azure App Service
        uses: azure/webapps-deploy@v3
        with:
          app-name: YOUR_APP_SERVICE_NAME
          publish-profile: ${{ secrets.AZURE_WEBAPP_PUBLISH_PROFILE }}
          package: backend

      # Needed only if you want to set DB_* from GitHub Secrets
      - name: Azure Login
        uses: azure/login@v2
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      - name: Set App Settings from GitHub Secrets
        run: |
          az webapp config appsettings set \
            --resource-group "YOUR_RESOURCE_GROUP" \
            --name "YOUR_APP_SERVICE_NAME" \
            --settings \
              DB_HOST="${{ secrets.DB_HOST }}" \
              DB_NAME="${{ secrets.DB_NAME }}" \
              DB_USER="${{ secrets.DB_USER }}" \
              DB_PASS="${{ secrets.DB_PASS }}" \
              DB_PORT="${{ secrets.DB_PORT }}" \
              DB_SSLMODE="${{ secrets.DB_SSLMODE }}" \
              ALLOWED_ORIGINS="${{ secrets.ALLOWED_ORIGINS }}"
